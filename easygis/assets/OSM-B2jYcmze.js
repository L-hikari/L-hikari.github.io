import{ad as pe,ae as fn,B as De,d as A,x as F,f as J,af as Dt,Z as K,ag as Te,ah as _n,ai as Ft,o as se,a1 as Me,m as Oe,aj as Nt,ak as mn,al as Ct,a5 as pn,am as Rt,an as Mi,ao as hi,ap as xt,a7 as Oi,aq as vt,ar as Si,as as yn,aa as D,a8 as P,E as x,j as zt,at as Di,O as it,$ as Fi,a3 as En,T as nt,au as Ni,av as Zt,a9 as st,z as X,aw as je,y as zi,ax as Zi,J as Kt,F as Xe,ay as Tn,az as Cn,aA as Rn,e as xn,aB as vn,aC as Ki,N as Ge,Q as U,a6 as It,aD as In,K as wn,aE as Ln,aF as Pn,aG as Ve,aH as ki,aI as ji,aJ as Gi,aK as ci,aL as An,aM as bn,aN as wt,p as ui,W as dt,c as kt,a as Mn,aO as di,A as jt,aP as On,aQ as Sn,k as Dn,aR as gi,a0 as Fn,X as Nn,g as at,aS as zn,h as Lt,aT as Zn,aU as qe,aV as Be,aW as Kn,aX as Le}from"./Polygon-hRDLPUY4.js";const W={ADD:"add",REMOVE:"remove"},fi={LENGTH:"length"};class Qe extends De{constructor(e,t,i){super(e),this.element=t,this.index=i}}class le extends pe{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(fi.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Qe(W.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Qe(W.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Qe(W.REMOVE,n,e)),this.dispatchEvent(new Qe(W.ADD,t,e))}updateLength_(){this.set(fi.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===e&&i!==t)throw new fn(58)}}const kn=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,jn=/^([a-z]*)$|^hsla?\(.*\)$/i;function Gn(s){return typeof s=="string"?s:Yn(s)}function Xn(s){const e=document.createElement("div");if(e.style.color=s,e.style.color!==""){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}const Vn=function(){const e={};let t=0;return function(i){let n;if(e.hasOwnProperty(i))n=e[i];else{if(t>=1024){let r=0;for(const o in e)r++&3||(delete e[o],--t)}n=Un(i),e[i]=n,++t}return n}}();function _i(s){return Array.isArray(s)?s:Vn(s)}function Un(s){let e,t,i,n,r;if(jn.exec(s)&&(s=Xn(s)),kn.exec(s)){const o=s.length-1;let a;o<=4?a=1:a=2;const l=o===4||o===8;e=parseInt(s.substr(1+0*a,a),16),t=parseInt(s.substr(1+1*a,a),16),i=parseInt(s.substr(1+2*a,a),16),l?n=parseInt(s.substr(1+3*a,a),16):n=255,a==1&&(e=(e<<4)+e,t=(t<<4)+t,i=(i<<4)+i,l&&(n=(n<<4)+n)),r=[e,t,i,n/255]}else s.startsWith("rgba(")?(r=s.slice(5,-1).split(",").map(Number),mi(r)):s.startsWith("rgb(")?(r=s.slice(4,-1).split(",").map(Number),r.push(1),mi(r)):A(!1,14);return r}function mi(s){return s[0]=F(s[0]+.5|0,0,255),s[1]=F(s[1]+.5|0,0,255),s[2]=F(s[2]+.5|0,0,255),s[3]=F(s[3],0,1),s}function Yn(s){let e=s[0];e!=(e|0)&&(e=e+.5|0);let t=s[1];t!=(t|0)&&(t=t+.5|0);let i=s[2];i!=(i|0)&&(i=i+.5|0);const n=s[3]===void 0?1:Math.round(s[3]*100)/100;return"rgba("+e+","+t+","+i+","+n+")"}class Wn{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,i){const n=pi(e,t,i);return n in this.cache_?this.cache_[n]:null}set(e,t,i,n){const r=pi(e,t,i);this.cache_[r]=n,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function pi(s,e,t){const i=t?Gn(t):"null";return e+":"+s+":"+i}const Xi=new Wn,I={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Vi extends pe{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[I.OPACITY]=e.opacity!==void 0?e.opacity:1,A(typeof t[I.OPACITY]=="number",64),t[I.VISIBLE]=e.visible!==void 0?e.visible:!0,t[I.Z_INDEX]=e.zIndex,t[I.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[I.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[I.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[I.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=F(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return J()}getLayerStatesArray(e){return J()}getExtent(){return this.get(I.EXTENT)}getMaxResolution(){return this.get(I.MAX_RESOLUTION)}getMinResolution(){return this.get(I.MIN_RESOLUTION)}getMinZoom(){return this.get(I.MIN_ZOOM)}getMaxZoom(){return this.get(I.MAX_ZOOM)}getOpacity(){return this.get(I.OPACITY)}getSourceState(){return J()}getVisible(){return this.get(I.VISIBLE)}getZIndex(){return this.get(I.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(I.EXTENT,e)}setMaxResolution(e){this.set(I.MAX_RESOLUTION,e)}setMinResolution(e){this.set(I.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(I.MAX_ZOOM,e)}setMinZoom(e){this.set(I.MIN_ZOOM,e)}setOpacity(e){A(typeof e=="number",64),this.set(I.OPACITY,e)}setVisible(e){this.set(I.VISIBLE,e)}setZIndex(e){this.set(I.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const me={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Y={ANIMATING:0,INTERACTING:1},H={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},Hn=42,Gt=256;function yi(s,e,t){return function(i,n,r,o,a){if(!i)return;if(!n&&!e)return i;const l=e?0:r[0]*n,c=e?0:r[1]*n,h=a?a[0]:0,u=a?a[1]:0;let d=s[0]+l/2+h,g=s[2]-l/2+h,f=s[1]+c/2+u,_=s[3]-c/2+u;d>g&&(d=(g+d)/2,g=d),f>_&&(f=(_+f)/2,_=f);let T=F(i[0],d,g),E=F(i[1],f,_);if(o&&t&&n){const p=30*n;T+=-p*Math.log(1+Math.max(0,d-i[0])/p)+p*Math.log(1+Math.max(0,i[0]-g)/p),E+=-p*Math.log(1+Math.max(0,f-i[1])/p)+p*Math.log(1+Math.max(0,i[1]-_)/p)}return[T,E]}}function qn(s){return s}function Xt(s,e,t,i){const n=K(e)/t[0],r=Te(e)/t[1];return i?Math.min(s,Math.max(n,r)):Math.min(s,Math.min(n,r))}function Vt(s,e,t){let i=Math.min(s,e);const n=50;return i*=Math.log(1+n*Math.max(0,s/e-1))/n+1,t&&(i=Math.max(i,t),i/=Math.log(1+n*Math.max(0,t/s-1))/n+1),F(i,t/2,e*2)}function Bn(s,e,t,i){return e=e!==void 0?e:!0,function(n,r,o,a){if(n!==void 0){const l=s[0],c=s[s.length-1],h=t?Xt(l,t,o,i):l;if(a)return e?Vt(n,h,c):F(n,c,h);const u=Math.min(h,n),d=Math.floor(Dt(s,u,r));return s[d]>h&&d<s.length-1?s[d+1]:s[d]}}}function Qn(s,e,t,i,n,r){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,c){if(o!==void 0){const h=n?Xt(e,n,l,r):e;if(c)return i?Vt(o,h,t):F(o,t,h);const u=1e-9,d=Math.ceil(Math.log(e/h)/Math.log(s)-u),g=-a*(.5-u)+.5,f=Math.min(h,o),_=Math.floor(Math.log(e/f)/Math.log(s)+g),T=Math.max(d,_),E=e/Math.pow(s,T);return F(E,t,h)}}}function Ei(s,e,t,i,n){return t=t!==void 0?t:!0,function(r,o,a,l){if(r!==void 0){const c=i?Xt(s,i,a,n):s;return!t||!l?F(r,e,c):Vt(r,c,e)}}}function Ut(s){if(s!==void 0)return 0}function Ti(s){if(s!==void 0)return s}function $n(s){const e=2*Math.PI/s;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function Jn(s){return s=s||_n(5),function(e,t){if(t)return e;if(e!==void 0)return Math.abs(e)<=s?0:e}}function Ui(s){return Math.pow(s,3)}function Fe(s){return 1-Ui(1-s)}function es(s){return 3*s*s-2*s*s*s}function ts(s){return s}const gt=0;class oe extends pe{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Ft(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&yn(),e.center&&(e.center=se(e.center,this.projection_)),e.extent&&(e.extent=Me(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in H)delete t[a];this.setProperties(t,!0);const i=ns(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const n=is(e),r=i.constraint,o=ss(e);this.constraints_={center:n,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const n=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(n[3]-t[3]+t[1]-n[1]),a=r/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=se(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=se(n.anchor,this.getProjection())),t[i]=n}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let n=0;for(;n<t&&!this.isDef();++n){const h=arguments[n];h.center&&this.setCenterInternal(h.center),h.zoom!==void 0?this.setZoom(h.zoom):h.resolution&&this.setResolution(h.resolution),h.rotation!==void 0&&this.setRotation(h.rotation)}if(n===t){i&&$e(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const c=[];for(;n<t;++n){const h=arguments[n],u={start:r,complete:!1,anchor:h.anchor,duration:h.duration!==void 0?h.duration:1e3,easing:h.easing||es,callback:i};if(h.center&&(u.sourceCenter=o,u.targetCenter=h.center.slice(),o=u.targetCenter),h.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(h.zoom),a=u.targetResolution):h.resolution&&(u.sourceResolution=a,u.targetResolution=h.resolution,a=u.targetResolution),h.rotation!==void 0){u.sourceRotation=l;const d=Oe(h.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}rs(u)?u.complete=!0:r+=u.duration,c.push(u)}this.animations_.push(c),this.setHint(Y.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Y.ANIMATING]>0}getInteracting(){return this.hints_[Y.INTERACTING]>0}cancelAnimations(){this.setHint(Y.ANIMATING,-this.hints_[Y.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const n=this.animations_[t];if(n[0].callback&&$e(n[0].callback,!1),!e)for(let r=0,o=n.length;r<o;++r){const a=n[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let r=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const c=e-l.start;let h=l.duration>0?c/l.duration:1;h>=1?(l.complete=!0,h=1):r=!1;const u=l.easing(h);if(l.sourceCenter){const d=l.sourceCenter[0],g=l.sourceCenter[1],f=l.targetCenter[0],_=l.targetCenter[1];this.nextCenter_=l.targetCenter;const T=d+u*(f-d),E=g+u*(_-g);this.targetCenter_=[T,E]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const g=this.getViewportSize_(this.getRotation()),f=this.constraints_.resolution(d,0,g,!0);this.targetCenter_=this.calculateCenterZoom(f,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?Oe(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const g=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(g,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(Y.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&$e(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-t[0],n[1]-t[1]],Nt(i,e-this.getRotation()),mn(i,t)),i}calculateCenterZoom(e,t){let i;const n=this.getCenterInternal(),r=this.getResolution();if(n!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-n[0])/r,a=t[1]-e*(t[1]-n[1])/r;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],n=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(n*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Ct(e,this.getProjection())}getCenterInternal(){return this.get(H.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return pn(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();A(t,1);const i=this.getResolution();A(i!==void 0,2);const n=this.getRotation();return A(n!==void 0,3),Rt(t,i,n,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(H.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Me(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=K(e)/t[0],n=Te(e)/t[1];return Math.max(i,n)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(t/i)/Math.log(e);return function(r){return t/Math.pow(e,r*n)}}getRotation(){return this.get(H.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(i/n)/t;return function(o){return Math.log(i/o)/t/r}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();n=ft(n,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,i)}return{center:n.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,n;if(this.resolutions_){const r=Dt(this.resolutions_,e,1);t=r,i=this.resolutions_[r],r==this.resolutions_.length-1?n=2:n=i/this.resolutions_[r+1]}else i=this.maxResolution_,n=this.zoomFactor_;return t+Math.log(i/e)/Math.log(n)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=F(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,F(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(A(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function",24),Array.isArray(e)){A(!Mi(e),25);const n=Me(e,this.getProjection());i=hi(n)}else if(e.getType()==="Circle"){const n=Me(e.getExtent(),this.getProjection());i=hi(n),i.rotate(this.getRotation(),xt(n))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),n=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,c=-1/0,h=-1/0;for(let u=0,d=r.length;u<d;u+=o){const g=r[u]*i-r[u+1]*n,f=r[u]*n+r[u+1]*i;a=Math.min(a,g),l=Math.min(l,f),c=Math.max(c,g),h=Math.max(h,f)}return[a,l,c,h]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const n=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const c=this.getRotation(),h=Math.sin(c),u=Math.cos(c),d=xt(a);d[0]+=(n[1]-n[3])/2*l,d[1]+=(n[0]-n[2])/2*l;const g=d[0]*u-d[1]*h,f=d[1]*u+d[0]*h,_=this.getConstrainedCenter([g,f],l),T=t.callback?t.callback:Oi;t.duration!==void 0?this.animateInternal({resolution:l,center:_,duration:t.duration,easing:t.easing},T):(this.targetResolution_=l,this.targetCenter_=_,this.applyTargetState_(!1,!0),$e(T,!0))}centerOn(e,t,i){this.centerOnInternal(se(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(ft(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,n){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=ft(e,n,[a[0]/2+o[3],a[1]/2+o[0]],t,i);r=[e[0]-l[0],e[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Ct(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&se(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,n,i);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=se(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&se(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,n,r));this.get(H.ROTATION)!==n&&this.set(H.ROTATION,n),this.get(H.RESOLUTION)!==o&&(this.set(H.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(H.CENTER)||!vt(this.get(H.CENTER),a))&&this.set(H.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const n=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!vt(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:e,easing:Fe,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Y.INTERACTING,1)}endInteraction(e,t,i){i=i&&se(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(Y.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function $e(s,e){setTimeout(function(){s(e)},0)}function is(s){if(s.extent!==void 0){const t=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return yi(s.extent,s.constrainOnlyCenter,t)}const e=Ft(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,yi(t,!1,!1)}return qn}function ns(s){let e,t,i,o=s.minZoom!==void 0?s.minZoom:gt,a=s.maxZoom!==void 0?s.maxZoom:28;const l=s.zoomFactor!==void 0?s.zoomFactor:2,c=s.multiWorld!==void 0?s.multiWorld:!1,h=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,u=s.showFullExtent!==void 0?s.showFullExtent:!1,d=Ft(s.projection,"EPSG:3857"),g=d.getExtent();let f=s.constrainOnlyCenter,_=s.extent;if(!c&&!_&&d.isGlobal()&&(f=!1,_=g),s.resolutions!==void 0){const T=s.resolutions;t=T[o],i=T[a]!==void 0?T[a]:T[T.length-1],s.constrainResolution?e=Bn(T,h,!f&&_,u):e=Ei(t,i,h,!f&&_,u)}else{const E=(g?Math.max(K(g),Te(g)):360*Si.degrees/d.getMetersPerUnit())/Gt/Math.pow(2,gt),p=E/Math.pow(2,28-gt);t=s.maxResolution,t!==void 0?o=0:t=E/Math.pow(l,o),i=s.minResolution,i===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?i=t/Math.pow(l,a):i=E/Math.pow(l,a):i=p),a=o+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,a-o),s.constrainResolution?e=Qn(l,t,i,h,!f&&_,u):e=Ei(t,i,h,!f&&_,u)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:l}}function ss(s){if(s.enableRotation!==void 0?s.enableRotation:!0){const t=s.constrainRotation;return t===void 0||t===!0?Jn():t===!1?Ti:typeof t=="number"?$n(t):Ti}return Ut}function rs(s){return!(s.sourceCenter&&s.targetCenter&&!vt(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function ft(s,e,t,i,n){const r=Math.cos(-n);let o=Math.sin(-n),a=s[0]*r-s[1]*o,l=s[1]*r+s[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const c=a*r-l*o,h=l*r+a*o;return[c,h]}class Yt extends Vi{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(I.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(I.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(D(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=P(e,x.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;e instanceof oe?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e;const i=this.getExtent();return this.getVisible()&&Wt(this.getLayerState(),t.viewState)&&(!i||zt(i,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const i=this.getSource();if(i&&(t=i.getAttributions()),!t)return[];const n=e instanceof oe?e.getViewStateAndExtent():e;let r=t(n);return Array.isArray(r)||(r=[r]),r}render(e,t){const i=this.getRenderer();if(i.prepareFrame(e))return this.rendered=!0,i.renderFrame(e,t)}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(I.MAP,e)}getMapInternal(){return this.get(I.MAP)}setMap(e){this.mapPrecomposeKey_&&(D(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(D(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=P(e,me.PRECOMPOSE,function(t){const n=t.frameState.layerStatesArray,r=this.getLayerState(!1);A(!n.some(function(o){return o.layer===r.layer}),67),n.push(r)},this),this.mapRenderKey_=P(this,x.CHANGE,e.render,e),this.changed())}setSource(e){this.set(I.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Wt(s,e){if(!s.visible)return!1;const t=e.resolution;if(t<s.minResolution||t>=s.maxResolution)return!1;const i=e.zoom;return i>s.minZoom&&i<=s.maxZoom}class os extends Di{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){J()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;it(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Fi(n,i)}forEachFeatureAtCoordinate(e,t,i,n,r,o,a,l){let c;const h=t.viewState;function u(m,R,w,v){return r.call(o,R,m?w:null,v)}const d=h.projection,g=En(e.slice(),d),f=[[0,0]];if(d.canWrapX()&&n){const m=d.getExtent(),R=K(m);f.push([-R,0],[R,0])}const _=t.layerStatesArray,T=_.length,E=[],p=[];for(let m=0;m<f.length;m++)for(let R=T-1;R>=0;--R){const w=_[R],v=w.layer;if(v.hasRenderer()&&Wt(w,h)&&a.call(l,v)){const b=v.getRenderer(),N=v.getSource();if(b&&N){const Z=N.getWrapX()?g:e,q=u.bind(null,w.managed);p[0]=Z[0]+f[m][0],p[1]=Z[1]+f[m][1],c=b.forEachFeatureAtCoordinate(p,t,i,q,E)}if(c)return c}}if(E.length===0)return;const y=1/E.length;return E.forEach((m,R)=>m.distanceSq+=R*y),E.sort((m,R)=>m.distanceSq-R.distanceSq),E.some(m=>c=m.callback(m.feature,m.layer,m.geometry)),c}hasFeatureAtCoordinate(e,t,i,n,r,o){return this.forEachFeatureAtCoordinate(e,t,i,n,nt,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){J()}scheduleExpireIconCache(e){Xi.canExpireCache()&&e.postRenderFunctions.push(as)}}function as(s,e){Xi.expire()}class Yi extends De{constructor(e,t,i,n){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=n}}const Je="ol-hidden",lt="ol-unselectable",Ht="ol-control",Ci="ol-collapsed",ls=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Ri=["style","variant","weight","size","lineHeight","family"],Wi=function(s){const e=s.match(ls);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,n=Ri.length;i<n;++i){const r=e[i+1];r!==void 0&&(t[Ri[i]]=r)}return t.families=t.family.split(/,\s?/),t};function Ce(s,e,t,i){let n;return t&&t.length?n=t.shift():Ni?n=new OffscreenCanvas(s||300,e||300):n=document.createElement("canvas"),s&&(n.width=s),e&&(n.height=e),n.getContext("2d",i)}function qt(s){const e=s.canvas;e.width=1,e.height=1,s.clearRect(0,0,1,1)}function xi(s,e){const t=e.parentNode;t&&t.replaceChild(s,e)}function Pt(s){return s&&s.parentNode?s.parentNode.removeChild(s):null}function hs(s){for(;s.lastChild;)s.removeChild(s.lastChild)}function cs(s,e){const t=s.childNodes;for(let i=0;;++i){const n=t[i],r=e[i];if(!n&&!r)break;if(n!==r){if(!n){s.appendChild(r);continue}if(!r){s.removeChild(n),--i;continue}s.insertBefore(r,n)}}}const Rr="10px sans-serif",xr="#000",vr="round",Ir=[],wr=0,Lr="round",Pr=10,Ar="#000",br="center",Mr="middle",Or=[0,0,0,0],Sr=1,re=new pe;let Pe=null,At;const bt={},Dr=function(){const e="32px ",t=["monospace","serif"],i=t.length,n="wmytzilWMYTZIL@#/&?$%10";let r,o;function a(c,h,u){let d=!0;for(let g=0;g<i;++g){const f=t[g];if(o=rt(c+" "+h+" "+e+f,n),u!=f){const _=rt(c+" "+h+" "+e+u+","+f,n);d=d&&_!=o}}return!!d}function l(){let c=!0;const h=re.getKeys();for(let u=0,d=h.length;u<d;++u){const g=h[u];re.get(g)<100&&(a.apply(this,g.split(`
`))?(Zt(bt),Pe=null,At=void 0,re.set(g,100)):(re.set(g,re.get(g)+1,!0),c=!1))}c&&(clearInterval(r),r=void 0)}return function(c){const h=Wi(c);if(!h)return;const u=h.families;for(let d=0,g=u.length;d<g;++d){const f=u[d],_=h.style+`
`+h.weight+`
`+f;re.get(_)===void 0&&(re.set(_,100,!0),a(h.style,h.weight,f)||(re.set(_,0,!0),r===void 0&&(r=setInterval(l,32))))}}}(),us=function(){let s;return function(e){let t=bt[e];if(t==null){if(Ni){const i=Wi(e),n=Hi(e,"Žg");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=e,document.body.appendChild(s),t=s.offsetHeight,document.body.removeChild(s);bt[e]=t}return t}}();function Hi(s,e){return Pe||(Pe=Ce(1,1)),s!=At&&(Pe.font=s,At=Pe.font),Pe.measureText(e)}function rt(s,e){return Hi(s,e).width}function Fr(s,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((n,r)=>Math.max(n,rt(s,r)),0);return t[e]=i,i}function Nr(s,e){const t=[],i=[],n=[];let r=0,o=0,a=0,l=0;for(let c=0,h=e.length;c<=h;c+=2){const u=e[c];if(u===`
`||c===h){r=Math.max(r,o),n.push(o),o=0,a+=l;continue}const d=e[c+1]||s.font,g=rt(d,u);t.push(g),o+=g;const f=us(d);i.push(f),l=Math.max(l,f)}return{width:r,height:a,widths:t,heights:i,lineWidths:n}}function zr(s,e,t,i,n,r,o,a,l,c,h){s.save(),t!==1&&(s.globalAlpha*=t),e&&s.setTransform.apply(s,e),i.contextInstructions?(s.translate(l,c),s.scale(h[0],h[1]),ds(i,s)):h[0]<0||h[1]<0?(s.translate(l,c),s.scale(h[0],h[1]),s.drawImage(i,n,r,o,a,0,0,o,a)):s.drawImage(i,n,r,o,a,l,c,o*h[0],a*h[1]),s.restore()}function ds(s,e){const t=s.contextInstructions;for(let i=0,n=t.length;i<n;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class gs extends os{constructor(e){super(e),this.fontChangeListenerKey_=P(re,st.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=lt+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const n=new Yi(e,void 0,t);i.dispatchEvent(n)}}disposeInternal(){D(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(me.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),i=e.viewState;this.children_.length=0;const n=[];let r=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const c=l.layer,h=c.getSourceState();if(!Wt(l,i)||h!="ready"&&h!="undefined"){c.unrender();continue}const u=c.render(e,r);u&&(u!==r&&(this.children_.push(u),r=u),"getDeclutter"in c&&n.push(c))}for(let o=n.length-1;o>=0;--o)n[o].renderDeclutter(e);cs(this.element_,this.children_),this.dispatchRenderEvent(me.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}}class _e extends De{constructor(e,t){super(e),this.layer=t}}const _t={LAYERS:"layers"};class Ne extends Vi{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(_t.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new le(i.slice(),{unique:!0}):A(typeof i.getArray=="function",43):i=new le(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(D),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(P(e,W.ADD,this.handleLayersAdd_,this),P(e,W.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(D);Zt(this.listenerKeys_);const t=e.getArray();for(let i=0,n=t.length;i<n;i++){const r=t[i];this.registerLayerListeners_(r),this.dispatchEvent(new _e("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[P(e,st.PROPERTYCHANGE,this.handleLayerChange_,this),P(e,x.CHANGE,this.handleLayerChange_,this)];e instanceof Ne&&t.push(P(e,"addlayer",this.handleLayerGroupAdd_,this),P(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[X(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new _e("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new _e("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new _e("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=X(t);this.listenerKeys_[i].forEach(D),delete this.listenerKeys_[i],this.dispatchEvent(new _e("removelayer",t)),this.changed()}getLayers(){return this.get(_t.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let n=0,r=i.length;n<r;++n)this.dispatchEvent(new _e("removelayer",i[n]))}this.set(_t.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const n=this.getLayerState();let r=n.zIndex;!e&&n.zIndex===void 0&&(r=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=je(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=r)}return t}getSourceState(){return"ready"}}class Ae extends De{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class ge extends Ae{constructor(e,t,i,n,r,o){super(e,t,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const M={SINGLECLICK:"singleclick",CLICK:x.CLICK,DBLCLICK:x.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Mt={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class fs extends zi{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=P(i,Mt.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=P(i,Mt.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(x.TOUCHMOVE,this.boundHandleTouchMove_,Zi?{passive:!1}:!1)}emulateClick_(e){let t=new ge(M.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new ge(M.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new ge(M.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==M.POINTERUP||t.type==M.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==t.target){delete this.trackedTouches_[n];break}}else(t.type==M.POINTERDOWN||t.type==M.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new ge(M.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(D),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new ge(M.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(P(i,M.POINTERMOVE,this.handlePointerMove_,this),P(i,M.POINTERUP,this.handlePointerUp_,this),P(this.element_,M.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(P(this.element_.getRootNode(),M.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new ge(M.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new ge(M.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(D(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(x.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(D(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(D),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const fe={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},z={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},ot=1/0;class _s{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Zt(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(e){A(!(this.keyFunction_(e)in this.queuedElements_),31);const t=this.priorityFunction_(e);return t!=ot?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,n=t.length,r=t[e],o=i[e],a=e;for(;e<n>>1;){const l=this.getLeftChildIndex_(e),c=this.getRightChildIndex_(e),h=c<n&&i[c]<i[l]?c:l;t[e]=t[h],i[e]=i[h],e=h}t[e]=r,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,n=this.priorities_,r=i[t],o=n[t];for(;t>e;){const a=this.getParentIndex_(t);if(n[a]>o)i[t]=i[a],n[t]=n[a],t=a;else break}i[t]=r,n[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let n=0;const r=t.length;let o,a,l;for(a=0;a<r;++a)o=t[a],l=e(o),l==ot?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=l,t[n++]=o);t.length=n,i.length=n,this.heapify_()}}const C={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class ms extends _s{constructor(e,t){super(function(i){return e.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(x.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===C.LOADED||i===C.ERROR||i===C.EMPTY){i!==C.ERROR&&t.removeEventListener(x.CHANGE,this.boundHandleTileChange_);const n=t.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0,n,r,o;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;)r=this.dequeue()[0],o=r.getKey(),n=r.getState(),n===C.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,r.load())}}function ps(s,e,t,i,n){if(!s||!(t in s.wantedTiles)||!s.wantedTiles[t][e.getKey()])return ot;const r=s.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}class Bt extends pe{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){Pt(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&Pt(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)D(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Oi&&this.listenerKeys.push(P(e,fe.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class ys extends Bt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",n=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"›",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(x.CLICK,this.handleClick_.bind(this),!1);const c=t+" "+lt+" "+Ht+(this.collapsed_&&this.collapsible_?" "+Ci:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=c,h.appendChild(this.toggleButton_),h.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(n=>n.getAttributions(e)))),i=!this.getMap().getAllLayers().some(n=>n.getSource()&&n.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),t}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Kt(t,this.renderedAttributions_)){hs(this.ulElement_);for(let n=0,r=t.length;n<r;++n){const o=document.createElement("li");o.innerHTML=t[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Ci),this.collapsed_?xi(this.collapseLabel_,this.label_):xi(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class Es extends Bt{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"⇧",n=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(x.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+lt+" "+Ht,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Je)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Fe}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Je);!r&&i===0?this.element.classList.add(Je):r&&i!==0&&this.element.classList.remove(Je)}this.label_.style.transform=n}this.rotation_=i}}class Ts extends Bt{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,n=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"–",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",c=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=n,h.setAttribute("type","button"),h.title=l,h.appendChild(typeof o=="string"?document.createTextNode(o):o),h.addEventListener(x.CLICK,this.handleClick_.bind(this,i),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=c,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(x.CLICK,this.handleClick_.bind(this,-i),!1);const d=t+" "+lt+" "+Ht,g=this.element;g.className=d,g.appendChild(h),g.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const r=i.getConstrainedZoom(n+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:Fe})):i.setZoom(r)}}}function Cs(s){s=s||{};const e=new le;return(s.zoom!==void 0?s.zoom:!0)&&e.push(new Ts(s.zoomOptions)),(s.rotate!==void 0?s.rotate:!0)&&e.push(new Es(s.rotateOptions)),(s.attribution!==void 0?s.attribution:!0)&&e.push(new ys(s.attributionOptions)),e}const vi={ACTIVE:"active"};class Ue extends pe{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(vi.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(vi.ACTIVE,e)}setMap(e){this.map_=e}}function Rs(s,e,t){const i=s.getCenterInternal();if(i){const n=[i[0]+e[0],i[1]+e[1]];s.animateInternal({duration:t!==void 0?t:250,easing:ts,center:s.getConstrainedCenter(n)})}}function Qt(s,e,t,i){const n=s.getZoom();if(n===void 0)return;const r=s.getConstrainedZoom(n+e),o=s.getResolutionForZoom(r);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:Fe})}class xs extends Ue{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==M.DBLCLICK){const i=e.originalEvent,n=e.map,r=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=n.getView();Qt(a,o,r,this.duration_),i.preventDefault(),t=!0}return!t}}class Ye extends Ue{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==M.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==M.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==M.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==M.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function $t(s){const e=s.length;let t=0,i=0;for(let n=0;n<e;n++)t+=s[n].clientX,i+=s[n].clientY;return{clientX:t/e,clientY:i/e}}function Ot(s){const e=arguments;return function(t){let i=!0;for(let n=0,r=e.length;n<r&&(i=i&&e[n](t),!!i);++n);return i}}const vs=function(s){const e=s.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Is=function(s){const e=s.map.getTargetElement(),t=s.map.getOwnerDocument().activeElement;return e.contains(t)},qi=function(s){return s.map.getTargetElement().hasAttribute("tabindex")?Is(s):!0},ws=nt,Bi=function(s){const e=s.originalEvent;return e.button==0&&!(Tn&&Cn&&e.ctrlKey)},Zr=Xe,Qi=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Ls=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},$i=function(s){const e=s.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},mt=function(s){const e=s.originalEvent;return A(e!==void 0,56),e.pointerType=="mouse"},Ps=function(s){const e=s.originalEvent;return A(e!==void 0,56),e.isPrimary&&e.button===0};class As extends Ye{constructor(e){super({stopDown:Xe}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Ot(Qi,Ps);this.condition_=e.onFocusOnly?Ot(qi,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,n=t.getEventPixel($t(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const r=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],a=e.map.getView();Rn(r,a.getResolution()),Nt(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-n*Math.cos(r),a[1]-n*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:Fe})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class bs extends Ye{constructor(e){e=e||{},super({stopDown:Xe}),this.condition_=e.condition?e.condition:vs,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!mt(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===Ut)return;const n=t.getSize(),r=e.pixel,o=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return mt(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return mt(e)&&Bi(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class Ms extends Di{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+i,n.top=Math.min(e[1],t[1])+i,n.width=Math.abs(t[0]-e[0])+i,n.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new xn([n])}getGeometry(){return this.geometry_}}const et={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class pt extends De{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class Os extends Ye{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new Ms(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:Bi,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const n=i[0]-t[0],r=i[1]-t[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new pt(et.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new pt(t?et.BOXEND:et.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new pt(et.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}class Ss extends Os{constructor(e){e=e||{};const t=e.condition?e.condition:Ls;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:Fe})}}const Ee={LEFT:37,UP:38,RIGHT:39,DOWN:40};class Ds extends Ue{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return Qi(t)&&$i(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==x.KEYDOWN){const i=e.originalEvent,n=i.keyCode;if(this.condition_(e)&&(n==Ee.DOWN||n==Ee.LEFT||n==Ee.RIGHT||n==Ee.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,c=0;n==Ee.DOWN?c=-a:n==Ee.LEFT?l=-a:n==Ee.RIGHT?l=a:c=a;const h=[l,c];Nt(h,o.getRotation()),Rs(o,h,this.duration_),i.preventDefault(),t=!0}}return!t}}class Fs extends Ue{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:$i,this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==x.KEYDOWN||e.type==x.KEYPRESS){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==="+"||n==="-")){const r=e.map,o=n==="+"?this.delta_:-this.delta_,a=r.getView();Qt(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}class Ns{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const n=this.points_[t+2]-this.points_[i+2];if(n<1e3/60)return!1;const r=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class zs extends Ue{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:ws;this.condition_=e.onFocusOnly?Ot(qi,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==x.WHEEL)return!0;const i=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let r;if(e.type==x.WHEEL&&(r=n.deltaY,vn&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=Ki),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-F(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Qt(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class Zs extends Ye{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Xe),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==Ut&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel($t(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class Ks extends Ye{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=Xe),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,c=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel($t(this.targetPointers))),l.render(),c.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function ks(s){s=s||{};const e=new le,t=new Ns(-.005,.05,100);return(s.altShiftDragRotate!==void 0?s.altShiftDragRotate:!0)&&e.push(new bs),(s.doubleClickZoom!==void 0?s.doubleClickZoom:!0)&&e.push(new xs({delta:s.zoomDelta,duration:s.zoomDuration})),(s.dragPan!==void 0?s.dragPan:!0)&&e.push(new As({onFocusOnly:s.onFocusOnly,kinetic:t})),(s.pinchRotate!==void 0?s.pinchRotate:!0)&&e.push(new Zs),(s.pinchZoom!==void 0?s.pinchZoom:!0)&&e.push(new Ks({duration:s.zoomDuration})),(s.keyboard!==void 0?s.keyboard:!0)&&(e.push(new Ds),e.push(new Fs({delta:s.zoomDelta,duration:s.zoomDuration}))),(s.mouseWheelZoom!==void 0?s.mouseWheelZoom:!0)&&e.push(new zs({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(s.shiftDragZoom!==void 0?s.shiftDragZoom:!0)&&e.push(new Ss({duration:s.zoomDuration})),e}function Kr(s,e,t){return t===void 0&&(t=[0,0]),t[0]=s[0]+2*e,t[1]=s[1]+2*e,t}function Ii(s){return s[0]>0&&s[1]>0}function js(s,e,t){return t===void 0&&(t=[0,0]),t[0]=s[0]*e+.5|0,t[1]=s[1]*e+.5|0,t}function ae(s,e){return Array.isArray(s)?s:(e===void 0?e=[s,s]:(e[0]=s,e[1]=s),e)}function Ji(s){if(s instanceof Yt){s.setMapInternal(null);return}s instanceof Ne&&s.getLayers().forEach(Ji)}function en(s,e){if(s instanceof Yt){s.setMapInternal(e);return}if(s instanceof Ne){const t=s.getLayers().getArray();for(let i=0,n=t.length;i<n;++i)en(t[i],e)}}class kr extends pe{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=Gs(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Ki,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Ge(),this.pixelToCoordinateTransform_=Ge(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||Cs(),this.interactions=t.interactions||ks({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new ms(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(z.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(z.VIEW,this.handleViewChanged_),this.addChangeListener(z.SIZE,this.handleSizeChanged_),this.addChangeListener(z.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof oe)&&e.view.then(function(n){i.setView(new oe(n))}),this.controls.addEventListener(W.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(W.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(W.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(W.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(W.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(W.REMOVE,n=>{const r=n.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){en(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:nt,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(n){i.push(n)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(n){n instanceof Ne?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const n=t.layerFilter!==void 0?t.layerFilter:nt,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,n,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),n=this.getSize(),r=i.width/n[0],o=i.height/n[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/r,(a.clientY-i.top)/o]}getTarget(){return this.get(z.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Ct(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?U(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(z.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof le){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=se(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?U(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(z.SIZE)}getView(){return this.get(z.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,n){return ps(this.frameState_,e,t,i,n)}handleBrowserEvent(e,t){t=t||e.type;const i=new ge(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===Mt.POINTERDOWN||i===x.WHEEL||i===x.KEYDOWN){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(r===n?n.documentElement:r).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,r=n;if(e){const o=e.viewHints;if(o[Y.ANIMATING]||o[Y.INTERACTING]){const a=Date.now()-e.time>8;n=a?0:8,r=a?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(me.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(me.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ae(fe.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ae(fe.LOADSTART,this,e))));const i=this.postRenderFunctions_;for(let n=0,r=i.length;n<r;++n)i[n](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,n=this.targetChangeHandlerKeys_.length;i<n;++i)D(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(x.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(x.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Pt(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new gs(this)),this.mapBrowserEventHandler_=new fs(this,this.moveTolerance_);for(const r in M)this.mapBrowserEventHandler_.addEventListener(M[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(x.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(x.WHEEL,this.boundHandleBrowserEvent_,Zi?{passive:!1}:!1);const i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[P(i,x.KEYDOWN,this.handleBrowserEvent,this),P(i,x.KEYPRESS,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(D(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(D(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=P(e,st.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=P(e,x.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(D),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new _e("addlayer",e)),this.layerGroupPropertyListenerKeys_=[P(e,st.PROPERTYCHANGE,this.render,this),P(e,x.CHANGE,this.render,this),P(e,"addlayer",this.handleLayerAdd_,this),P(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){Ji(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),n=this.frameState_;let r=null;if(t!==void 0&&Ii(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Rt(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:X(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=Rt(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!Mi(this.previousExtent_)&&!It(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Ae(fe.MOVESTART,this,n)),this.previousExtent_=In(this.previousExtent_)),this.previousExtent_&&!r.viewHints[Y.ANIMATING]&&!r.viewHints[Y.INTERACTING]&&!It(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Ae(fe.MOVEEND,this,r)),wn(r.extent,this.previousExtent_))),this.dispatchEvent(new Ae(fe.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(fe.LOADSTART)||this.hasListener(fe.LOADEND)||this.hasListener(me.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new _e("removelayer",t)),this.set(z.LAYERGROUP,e)}setSize(e){this.set(z.SIZE,e)}setTarget(e){this.set(z.TARGET,e)}setView(e){if(!e||e instanceof oe){this.set(z.VIEW,e);return}this.set(z.VIEW,new oe);const t=this;e.then(function(i){t.setView(new oe(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),r=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[r,o],!Ii(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Ln("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!Kt(t,i))&&(this.setSize(t),this.updateViewportSize_())}updateViewportSize_(){const e=this.getView();if(e){let t;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(t=[parseInt(i.width,10),parseInt(i.height,10)]),e.setViewportSize(t)}}}function Gs(s){let e=null;s.keyboardEventTarget!==void 0&&(e=typeof s.keyboardEventTarget=="string"?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const t={},i=s.layers&&typeof s.layers.getLayers=="function"?s.layers:new Ne({layers:s.layers});t[z.LAYERGROUP]=i,t[z.TARGET]=s.target,t[z.VIEW]=s.view instanceof oe?s.view:new oe;let n;s.controls!==void 0&&(Array.isArray(s.controls)?n=new le(s.controls.slice()):(A(typeof s.controls.getArray=="function",47),n=s.controls));let r;s.interactions!==void 0&&(Array.isArray(s.interactions)?r=new le(s.interactions.slice()):(A(typeof s.interactions.getArray=="function",48),r=s.interactions));let o;return s.overlays!==void 0?Array.isArray(s.overlays)?o=new le(s.overlays.slice()):(A(typeof s.overlays.getArray=="function",49),o=s.overlays):o=new le,{controls:n,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}const tt={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Xs extends Yt{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(tt.PRELOAD)}setPreload(e){this.set(tt.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(tt.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(tt.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const ke={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Vs extends Pn{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return J()}getData(e){return null}prepareFrame(e){return J()}renderFrame(e,t){return J()}loadedTileCallback(e,t,i){e[t]||(e[t]={}),e[t][i.tileCoord.toString()]=i}createLoadedTileFinder(e,t,i){return(n,r)=>{const o=this.loadedTileCallback.bind(this,i,n);return e.forEachLoadedTile(t,n,r,o)}}forEachFeatureAtCoordinate(e,t,i,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){e.target.getState()===ke.LOADED&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=ke.LOADED&&t!=ke.ERROR&&e.addEventListener(x.CHANGE,this.boundHandleImageChange_),t==ke.IDLE&&(e.load(),t=e.getState()),t==ke.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const jr=[];let be=null;function Us(){be=Ce(1,1,void 0,{willReadFrequently:!0})}class Ys extends Vs{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Ge(),this.pixelTransform=Ge(),this.inversePixelTransform=Ge(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,i){be||Us(),be.clearRect(0,0,1,1);let n;try{be.drawImage(e,t,i,1,1,0,0,1,1),n=be.getImageData(0,0,1,1).data}catch{return be=null,null}return n}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const n=this.getLayer().getClassName();let r,o;if(e&&e.className===n&&(!i||e&&e.style.backgroundColor&&Kt(_i(e.style.backgroundColor),_i(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){r=document.createElement("div"),r.className=n;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=Ce();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const n=Ve(i),r=ki(i),o=ji(i),a=Gi(i);U(t.coordinateToPixelTransform,n),U(t.coordinateToPixelTransform,r),U(t.coordinateToPixelTransform,o),U(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;U(l,n),U(l,r),U(l,o),U(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,i){const n=this.getLayer();if(n.hasListener(e)){const r=new Yi(e,this.inversePixelTransform,i,t);n.dispatchEvent(r)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(me.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(me.POSTRENDER,e,t)}getRenderTransform(e,t,i,n,r,o,a){const l=r/2,c=o/2,h=n/t,u=-h,d=-e[0]+a,g=-e[1];return it(this.tempTransform,l,c,h,u,-i,d,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class tn extends zi{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(x.CHANGE)}release(){this.state===C.ERROR&&this.setState(C.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==C.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==C.LOADED){e.interimTile=null;break}else e.getState()==C.LOADING?t=e:e.getState()==C.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==C.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){J()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:Ui(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}function Ws(s,e,t){const i=s;let n=!0,r=!1,o=!1;const a=[ci(i,x.LOAD,function(){o=!0,r||e()})];return i.src&&An?(r=!0,i.decode().then(function(){n&&e()}).catch(function(l){n&&(o?e():t())})):a.push(ci(i,x.ERROR,t)),function(){n=!1,a.forEach(D)}}class nn extends tn{constructor(e,t,i,n,r,o){super(e,t,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=C.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=C.ERROR,this.unlistenImage_(),this.image_=Hs(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=C.LOADED:this.state=C.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==C.ERROR&&(this.state=C.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==C.IDLE&&(this.state=C.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Ws(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Hs(){const s=Ce(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}const qs=.5,Bs=10,wi=.25;class Qs{constructor(e,t,i,n,r,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=bn(this.targetProj_,this.sourceProj_);this.transformInv_=function(p){const y=p[0]+"/"+p[1];return a[y]||(a[y]=l(p)),a[y]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&K(n)==K(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?K(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?K(this.targetProj_.getExtent()):null;const c=Ve(i),h=ki(i),u=ji(i),d=Gi(i),g=this.transformInv_(c),f=this.transformInv_(h),_=this.transformInv_(u),T=this.transformInv_(d),E=Bs+(o?Math.max(0,Math.ceil(Math.log2(wt(i)/(o*o*256*256)))):0);if(this.addQuad_(c,h,u,d,g,f,_,T,E),this.wrapsXInSource_){let p=1/0;this.triangles_.forEach(function(y,m,R){p=Math.min(p,y.source[0][0],y.source[1][0],y.source[2][0])}),this.triangles_.forEach(y=>{if(Math.max(y.source[0][0],y.source[1][0],y.source[2][0])-p>this.sourceWorldWidth_/2){const m=[[y.source[0][0],y.source[0][1]],[y.source[1][0],y.source[1][1]],[y.source[2][0],y.source[2][1]]];m[0][0]-p>this.sourceWorldWidth_/2&&(m[0][0]-=this.sourceWorldWidth_),m[1][0]-p>this.sourceWorldWidth_/2&&(m[1][0]-=this.sourceWorldWidth_),m[2][0]-p>this.sourceWorldWidth_/2&&(m[2][0]-=this.sourceWorldWidth_);const R=Math.min(m[0][0],m[1][0],m[2][0]);Math.max(m[0][0],m[1][0],m[2][0])-R<this.sourceWorldWidth_/2&&(y.source=m)}})}a={}}addTriangle_(e,t,i,n,r,o){this.triangles_.push({source:[n,r,o],target:[e,t,i]})}addQuad_(e,t,i,n,r,o,a,l,c){const h=ui([r,o,a,l]),u=this.sourceWorldWidth_?K(h)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&u>.5&&u<1;let f=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const T=ui([e,t,i,n]);f=K(T)/this.targetWorldWidth_>wi||f}!g&&this.sourceProj_.isGlobal()&&u&&(f=u>wi||f)}if(!f&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!zt(h,this.maxSourceExtent_))return;let _=0;if(!f&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)f=!0;else if(_=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),_!=1&&_!=2&&_!=4&&_!=8)return}if(c>0){if(!f){const T=[(e[0]+i[0])/2,(e[1]+i[1])/2],E=this.transformInv_(T);let p;g?p=(Oe(r[0],d)+Oe(a[0],d))/2-Oe(E[0],d):p=(r[0]+a[0])/2-E[0];const y=(r[1]+a[1])/2-E[1];f=p*p+y*y>this.errorThresholdSquared_}if(f){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const T=[(t[0]+i[0])/2,(t[1]+i[1])/2],E=this.transformInv_(T),p=[(n[0]+e[0])/2,(n[1]+e[1])/2],y=this.transformInv_(p);this.addQuad_(e,t,T,p,r,o,E,y,c-1),this.addQuad_(p,T,i,n,y,E,a,l,c-1)}else{const T=[(e[0]+t[0])/2,(e[1]+t[1])/2],E=this.transformInv_(T),p=[(i[0]+n[0])/2,(i[1]+n[1])/2],y=this.transformInv_(p);this.addQuad_(e,T,p,n,r,E,y,l,c-1),this.addQuad_(T,t,i,p,E,o,a,y,c-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}_&11||this.addTriangle_(e,i,n,r,a,l),_&14||this.addTriangle_(e,i,t,r,a,o),_&&(_&13||this.addTriangle_(t,n,e,o,l,r),_&7||this.addTriangle_(t,n,i,o,l,a))}calculateSourceExtent(){const e=kt();return this.triangles_.forEach(function(t,i,n){const r=t.source;dt(e,r[0]),dt(e,r[1]),dt(e,r[2])}),e}getTriangles(){return this.triangles_}}let yt;const Se=[];function Li(s,e,t,i,n){s.beginPath(),s.moveTo(0,0),s.lineTo(e,t),s.lineTo(i,n),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(e,i)+1,Math.max(t,n)),s.restore()}function Et(s,e){return Math.abs(s[e*4]-210)>2||Math.abs(s[e*4+3]-.75*255)>2}function $s(){if(yt===void 0){const s=Ce(6,6,Se);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",Li(s,4,5,4,0),Li(s,4,5,0,5);const e=s.getImageData(0,0,3,3).data;yt=Et(e,0)||Et(e,4)||Et(e,8),qt(s),Se.push(s.canvas)}return yt}function Pi(s,e,t,i){const n=Mn(t,e,s);let r=di(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=s.getMetersPerUnit();a!==void 0&&(r/=a);const l=s.getExtent();if(!l||jt(l,n)){const c=di(s,r,n)/r;isFinite(c)&&c>0&&(r/=c)}return r}function Js(s,e,t,i){const n=xt(t);let r=Pi(s,e,n,i);return(!isFinite(r)||r<=0)&&Dn(t,function(o){return r=Pi(s,e,o,i),isFinite(r)&&r>0}),r}function er(s,e,t,i,n,r,o,a,l,c,h,u){const d=Ce(Math.round(t*s),Math.round(t*e),Se);if(u||(d.imageSmoothingEnabled=!1),l.length===0)return d.canvas;d.scale(t,t);function g(m){return Math.round(m*t)/t}d.globalCompositeOperation="lighter";const f=kt();l.forEach(function(m,R,w){On(f,m.extent)});const _=K(f),T=Te(f),E=Ce(Math.round(t*_/i),Math.round(t*T/i),Se);u||(E.imageSmoothingEnabled=!1);const p=t/i;l.forEach(function(m,R,w){const v=m.extent[0]-f[0],b=-(m.extent[3]-f[3]),N=K(m.extent),Z=Te(m.extent);m.image.width>0&&m.image.height>0&&E.drawImage(m.image,c,c,m.image.width-2*c,m.image.height-2*c,v*p,b*p,N*p,Z*p)});const y=Ve(o);return a.getTriangles().forEach(function(m,R,w){const v=m.source,b=m.target;let N=v[0][0],Z=v[0][1],q=v[1][0],he=v[1][1],ce=v[2][0],ze=v[2][1];const B=g((b[0][0]-y[0])/r),ee=g(-(b[0][1]-y[1])/r),L=g((b[1][0]-y[0])/r),G=g(-(b[1][1]-y[1])/r),te=g((b[2][0]-y[0])/r),Q=g(-(b[2][1]-y[1])/r),ye=N,k=Z;N=0,Z=0,q-=ye,he-=k,ce-=ye,ze-=k;const $=[[q,he,0,0,L-B],[ce,ze,0,0,te-B],[0,0,q,he,G-ee],[0,0,ce,ze,Q-ee]],S=Sn($);if(S){if(d.save(),d.beginPath(),$s()||!u){d.moveTo(L,G);const O=4,Re=B-L,ue=ee-G;for(let j=0;j<O;j++)d.lineTo(L+g((j+1)*Re/O),G+g(j*ue/(O-1))),j!=O-1&&d.lineTo(L+g((j+1)*Re/O),G+g((j+1)*ue/(O-1)));d.lineTo(te,Q)}else d.moveTo(L,G),d.lineTo(B,ee),d.lineTo(te,Q);d.clip(),d.transform(S[0],S[2],S[1],S[3],B,ee),d.translate(f[0]-ye,f[3]-k),d.scale(i/t,-i/t),d.drawImage(E.canvas,0,0),d.restore()}}),qt(E),Se.push(E.canvas),h&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach(function(m,R,w){const v=m.target,b=(v[0][0]-y[0])/r,N=-(v[0][1]-y[1])/r,Z=(v[1][0]-y[0])/r,q=-(v[1][1]-y[1])/r,he=(v[2][0]-y[0])/r,ce=-(v[2][1]-y[1])/r;d.beginPath(),d.moveTo(Z,q),d.lineTo(b,N),d.lineTo(he,ce),d.closePath(),d.stroke()}),d.restore()),d.canvas}class St extends tn{constructor(e,t,i,n,r,o,a,l,c,h,u,d){super(r,C.IDLE,{interpolate:!!d}),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const g=n.getTileCoordExtent(this.wrappedTileCoord_),f=this.targetTileGrid_.getExtent();let _=this.sourceTileGrid_.getExtent();const T=f?je(g,f):g;if(wt(T)===0){this.state=C.EMPTY;return}const E=e.getExtent();E&&(_?_=je(_,E):_=E);const p=n.getResolution(this.wrappedTileCoord_[0]),y=Js(e,i,T,p);if(!isFinite(y)||y<=0){this.state=C.EMPTY;return}const m=h!==void 0?h:qs;if(this.triangulation_=new Qs(e,i,T,_,y*m,p),this.triangulation_.getTriangles().length===0){this.state=C.EMPTY;return}this.sourceZ_=t.getZForResolution(y);let R=this.triangulation_.calculateSourceExtent();if(_&&(e.canWrapX()?(R[1]=F(R[1],_[1],_[3]),R[3]=F(R[3],_[1],_[3])):R=je(R,_)),!wt(R))this.state=C.EMPTY;else{const w=t.getTileRangeForExtentAndZ(R,this.sourceZ_);for(let v=w.minX;v<=w.maxX;v++)for(let b=w.minY;b<=w.maxY;b++){const N=c(this.sourceZ_,v,b,a);N&&this.sourceTiles_.push(N)}this.sourceTiles_.length===0&&(this.state=C.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==C.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=C.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=er(n,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=C.LOADED}this.changed()}load(){if(this.state==C.IDLE){this.state=C.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==C.IDLE||i==C.LOADING){e++;const n=P(t,x.CHANGE,function(r){const o=t.getState();(o==C.LOADED||o==C.ERROR||o==C.EMPTY)&&(D(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,n){t.getState()==C.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(D),this.sourcesListenerKeys_=null}release(){this.canvas_&&(qt(this.canvas_.getContext("2d")),Se.push(this.canvas_),this.canvas_=null),super.release()}}class Jt{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Ie(s,e,t,i,n){return n!==void 0?(n.minX=s,n.maxX=e,n.minY=t,n.maxY=i,n):new Jt(s,e,t,i)}class tr extends Ys{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=kt(),this.tmpTileRange_=new Jt(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==C.LOADED||i==C.EMPTY||i==C.ERROR&&!n}getTile(e,t,i,n){const r=n.pixelRatio,o=n.viewState.projection,a=this.getLayer();let c=a.getSource().getTile(e,t,i,r,o);return c.getState()==C.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(c)||(c=c.getInterimTile()),c}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=U(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!jt(r,n))return null;const o=t.pixelRatio,a=t.viewState.projection,l=t.viewState,c=i.getRenderSource(),h=c.getTileGridForProjection(l.projection),u=c.getTilePixelRatio(t.pixelRatio);for(let d=h.getZForResolution(l.resolution);d>=h.getMinZoom();--d){const g=h.getTileCoordForCoordAndZ(n,d),f=c.getTile(d,g[1],g[2],o,a);if(!(f instanceof nn||f instanceof St)||f instanceof St&&f.getState()===C.EMPTY)return null;if(f.getState()!==C.LOADED)continue;const _=h.getOrigin(d),T=ae(h.getTileSize(d)),E=h.getResolution(d),p=Math.floor(u*((n[0]-_[0])/E-g[1]*T[0])),y=Math.floor(u*((_[1]-n[1])/E-g[2]*T[1])),m=Math.round(u*c.getGutterForProjection(l.projection));return this.getImageData(f.getImage(),p+m,y+m)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],n=e.viewState,r=n.projection,o=n.resolution,a=n.center,l=n.rotation,c=e.pixelRatio,h=this.getLayer(),u=h.getSource(),d=u.getRevision(),g=u.getTileGridForProjection(r),f=g.getZForResolution(o,u.zDirection),_=g.getResolution(f);let T=e.extent;const E=e.viewState.resolution,p=u.getTilePixelRatio(c),y=Math.round(K(T)/E*c),m=Math.round(Te(T)/E*c),R=i.extent&&Me(i.extent);R&&(T=je(T,Me(i.extent)));const w=_*y/2/p,v=_*m/2/p,b=[a[0]-w,a[1]-v,a[0]+w,a[1]+v],N=g.getTileRangeForExtentAndZ(T,f),Z={};Z[f]={};const q=this.createLoadedTileFinder(u,r,Z),he=this.tmpExtent,ce=this.tmpTileRange_;this.newTiles_=!1;const ze=l?gi(n.center,E,l,e.size):void 0;for(let $=N.minX;$<=N.maxX;++$)for(let S=N.minY;S<=N.maxY;++S){if(l&&!g.tileCoordIntersectsViewport([f,$,S],ze))continue;const O=this.getTile(f,$,S,e);if(this.isDrawableTile(O)){const j=X(this);if(O.getState()==C.LOADED){Z[f][O.tileCoord.toString()]=O;let xe=O.inTransition(j);xe&&i.opacity!==1&&(O.endTransition(j),xe=!1),!this.newTiles_&&(xe||!this.renderedTiles.includes(O))&&(this.newTiles_=!0)}if(O.getAlpha(j,e.time)===1)continue}const Re=g.getTileCoordChildTileRange(O.tileCoord,ce,he);let ue=!1;Re&&(ue=q(f+1,Re)),ue||g.forEachTileCoordParentTileRange(O.tileCoord,q,ce,he)}const B=_/o*c/p;it(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,l,-y/2,-m/2);const ee=Fn(this.pixelTransform);this.useContainer(t,ee,this.getBackground(e));const L=this.context,G=L.canvas;Fi(this.inversePixelTransform,this.pixelTransform),it(this.tempTransform,y/2,m/2,B,B,0,-y/2,-m/2),G.width!=y||G.height!=m?(G.width=y,G.height=m):this.containerReused||L.clearRect(0,0,y,m),R&&this.clipUnrotated(L,e,R),u.getInterpolate()||(L.imageSmoothingEnabled=!1),this.preRender(L,e),this.renderedTiles.length=0;let te=Object.keys(Z).map(Number);te.sort(Nn);let Q,ye,k;i.opacity===1&&(!this.containerReused||u.getOpaque(e.viewState.projection))?te=te.reverse():(Q=[],ye=[]);for(let $=te.length-1;$>=0;--$){const S=te[$],O=u.getTilePixelSize(S,c,r),ue=g.getResolution(S)/_,j=O[0]*ue*B,xe=O[1]*ue*B,ct=g.getTileCoordForCoordAndZ(Ve(b),S),ii=g.getTileCoordExtent(ct),We=U(this.tempTransform,[p*(ii[0]-b[0])/_,p*(b[3]-ii[3])/_]),hn=p*u.getGutterForProjection(r),ni=Z[S];for(const cn in ni){const ve=ni[cn],si=ve.tileCoord,ri=ct[1]-si[1],un=Math.round(We[0]-(ri-1)*j),oi=ct[2]-si[2],dn=Math.round(We[1]-(oi-1)*xe),ie=Math.round(We[0]-ri*j),ne=Math.round(We[1]-oi*xe),Ze=un-ie,Ke=dn-ne,ai=f===S,li=ai&&ve.getAlpha(X(this),e.time)!==1;let ut=!1;if(!li)if(Q){k=[ie,ne,ie+Ze,ne,ie+Ze,ne+Ke,ie,ne+Ke];for(let He=0,gn=Q.length;He<gn;++He)if(f!==S&&S<ye[He]){const V=Q[He];zt([ie,ne,ie+Ze,ne+Ke],[V[0],V[3],V[4],V[7]])&&(ut||(L.save(),ut=!0),L.beginPath(),L.moveTo(k[0],k[1]),L.lineTo(k[2],k[3]),L.lineTo(k[4],k[5]),L.lineTo(k[6],k[7]),L.moveTo(V[6],V[7]),L.lineTo(V[4],V[5]),L.lineTo(V[2],V[3]),L.lineTo(V[0],V[1]),L.clip())}Q.push(k),ye.push(S)}else L.clearRect(ie,ne,Ze,Ke);this.drawTileImage(ve,e,ie,ne,Ze,Ke,hn,ai),Q&&!li?(ut&&L.restore(),this.renderedTiles.unshift(ve)):this.renderedTiles.push(ve),this.updateUsedTiles(e.usedTiles,u,ve)}}return this.renderedRevision=d,this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!It(this.renderedExtent_,b),this.renderedExtent_=b,this.renderedPixelRatio=c,this.renderedProjection=r,this.manageTilePyramid(e,u,g,c,r,T,f,h.getPreload()),this.scheduleExpireCache(e,u),this.postRender(L,e),i.extent&&L.restore(),L.imageSmoothingEnabled=!0,ee!==G.style.transform&&(G.style.transform=ee),this.container}drawTileImage(e,t,i,n,r,o,a,l){const c=this.getTileImage(e);if(!c)return;const h=X(this),u=t.layerStatesArray[t.layerIndex],d=u.opacity*(l?e.getAlpha(h,t.time):1),g=d!==this.context.globalAlpha;g&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(c,a,a,c.width-2*a,c.height-2*a,i,n,r,o),g&&this.context.restore(),d!==u.opacity?t.animate=!0:l&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=(function(n,r,o){const a=X(n);a in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const n=X(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}manageTilePyramid(e,t,i,n,r,o,a,l,c){const h=X(t);h in e.wantedTiles||(e.wantedTiles[h]={});const u=e.wantedTiles[h],d=e.tileQueue,g=i.getMinZoom(),f=e.viewState.rotation,_=f?gi(e.viewState.center,e.viewState.resolution,f,e.size):void 0;let T=0,E,p,y,m,R,w;for(w=g;w<=a;++w)for(p=i.getTileRangeForExtentAndZ(o,w,p),y=i.getResolution(w),m=p.minX;m<=p.maxX;++m)for(R=p.minY;R<=p.maxY;++R)f&&!i.tileCoordIntersectsViewport([w,m,R],_)||(a-w<=l?(++T,E=t.getTile(w,m,R,n,r),E.getState()==C.IDLE&&(u[E.getKey()]=!0,d.isKeyQueued(E.getKey())||d.enqueue([E,h,i.getTileCoordCenter(E.tileCoord),y])),c!==void 0&&c(E)):t.useTile(w,m,R,r));t.updateCacheSize(T,r)}}class Gr extends Xs{constructor(e){super(e)}createRenderer(){return new tr(this)}}class ir{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return A(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return A(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){if(this.containsKey(e))return this.entries_[e].value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){A(!(e in this.entries_),16);const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function Ai(s,e,t,i){return i!==void 0?(i[0]=s,i[1]=e,i[2]=t,i):[s,e,t]}function ht(s,e,t){return s+"/"+e+"/"+t}function sn(s){return ht(s[0],s[1],s[2])}function nr(s){return s.split("/").map(Number)}function sr(s){return(s[1]<<s[0])+s[2]}function rr(s,e){const t=s[0],i=s[1],n=s[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(i,n):!0}class rn extends ir{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=nr(e)[0];this.forEach(n=>{n.tileCoord[0]!==i&&(this.remove(sn(n.tileCoord)),n.release())})}}const Tt={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class or extends pe{constructor(e){super(),this.projection=at(e.projection),this.attributions_=bi(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,n){t.viewResolver=i,t.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=bi(e),this.changed()}setState(e){this.state_=e,this.changed()}}function bi(s){return s?Array.isArray(s)?function(e){return s}:typeof s=="function"?s:function(e){return[s]}:null}const we=[0,0,0],de=5;class on{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,A(zn(this.resolutions_,function(n,r){return r-n}),17);let t;if(!e.origins){for(let n=0,r=this.resolutions_.length-1;n<r;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,A(this.origins_.length==this.resolutions_.length,20));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Ve(i)),A(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,A(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:Gt,A(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(n,r){const o=new Jt(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let r=n.minX,o=n.maxX;r<=o;++r)for(let a=n.minY,l=n.maxY;a<=l;++a)i([t,r,a])}forEachTileCoordParentTileRange(e,t,i,n){let r,o,a,l=null,c=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,n);c>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),a=Math.floor(a/2),r=Ie(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(l,c,i),t(c,r))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return Ie(r,r+1,o,o+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],r=e[1],o=e[2];if(t===n)return Ie(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-n),c=Math.floor(r*l),h=Math.floor(o*l);if(t<n)return Ie(c,c,h,h,i);const u=Math.floor(l*(r+1))-1,d=Math.floor(l*(o+1))-1;return Ie(c,u,h,d,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeExtent(e,t,i){const n=this.getOrigin(e),r=this.getResolution(e),o=ae(this.getTileSize(e),this.tmpSize_),a=n[0]+t.minX*o[0]*r,l=n[0]+(t.maxX+1)*o[0]*r,c=n[1]+t.minY*o[1]*r,h=n[1]+(t.maxY+1)*o[1]*r;return Lt(a,c,l,h,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,we);const n=we[1],r=we[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,we);const o=we[1],a=we[2];return Ie(n,o,r,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=ae(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=ae(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*r[0]*n,a=i[1]-(e[2]+1)*r[1]*n,l=o+r[0]*n,c=a+r[1]*n;return Lt(o,a,l,c,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),c=ae(this.getTileSize(o),this.tmpSize_);let h=a*(e-l[0])/i/c[0],u=a*(l[1]-t)/i/c[1];return n?(h=qe(h,de)-1,u=qe(u,de)-1):(h=Be(h,de),u=Be(u,de)),Ai(o,h,u,r)}getTileCoordForXYAndZ_(e,t,i,n,r){const o=this.getOrigin(i),a=this.getResolution(i),l=ae(this.getTileSize(i),this.tmpSize_);let c=(e-o[0])/a/l[0],h=(o[1]-t)/a/l[1];return n?(c=qe(c,de)-1,h=qe(h,de)-1):(c=Be(c,de),h=Be(h,de)),Ai(i,c,h,r)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=Dt(this.resolutions_,e,t||0);return F(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Zn(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}function an(s){let e=s.getDefaultTileGrid();return e||(e=cr(s),s.setDefaultTileGrid(e)),e}function ar(s,e,t){const i=e[0],n=s.getTileCoordCenter(e),r=ei(t);if(!jt(r,n)){const o=K(r),a=Math.ceil((r[0]-n[0])/o);return n[0]+=o*a,s.getTileCoordForCoordAndZ(n,i)}return e}function lr(s,e,t,i){i=i!==void 0?i:"top-left";const n=ln(s,e,t);return new on({extent:s,origin:Kn(s,i),resolutions:n,tileSize:t})}function hr(s){const e=s||{},t=e.extent||at("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:ln(t,e.maxZoom,e.tileSize,e.maxResolution)};return new on(i)}function ln(s,e,t,i){e=e!==void 0?e:Hn,t=ae(t!==void 0?t:Gt);const n=Te(s),r=K(s);i=i>0?i:Math.max(r/t[0],n/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function cr(s,e,t,i){const n=ei(s);return lr(n,e,t,i)}function ei(s){s=at(s);let e=s.getExtent();if(!e){const t=180*Si.degrees/s.getMetersPerUnit();e=Lt(-t,-t,t,t)}return e}class ur extends or{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&ae(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new rn(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,n){const r=this.getTileCacheForProjection(e);if(!r)return!1;let o=!0,a,l,c;for(let h=i.minX;h<=i.maxX;++h)for(let u=i.minY;u<=i.maxY;++u)l=ht(t,h,u),c=!1,r.containsKey(l)&&(a=r.get(l),c=a.getState()===C.LOADED,c&&(c=n(a)!==!1)),c||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,r){return J()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:an(e)}getTileCacheForProjection(e){const t=this.getProjection();return A(t===null||Le(t,e),68),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),o=ae(n.getTileSize(e),this.tmpSize);return r==1?o:js(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=ar(i,e,t)),rr(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,n){}}class dr extends De{constructor(e,t){super(e),this.tile=t}}function gr(s,e){const t=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,r=/\{-y\}/g;return function(o,a,l){if(o)return s.replace(t,o[0].toString()).replace(i,o[1].toString()).replace(n,o[2].toString()).replace(r,function(){const c=o[0],h=e.getFullTileRange(c);return A(h,55),(h.getHeight()-o[2]-1).toString()})}}function fr(s,e){const t=s.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=gr(s[n],e);return _r(i)}function _r(s){return s.length===1?s[0]:function(e,t,i){if(!e)return;const n=sr(e),r=Oe(n,s.length);return s[r](e,t,i)}}function mr(s){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(s);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let r;for(r=i;r<=n;++r)e.push(s.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(s),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(s.replace(t[0],n.toString()));return e}return e.push(s),e}class ti extends ur{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===ti.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=X(t),n=t.getState();let r;n==C.LOADING?(this.tileLoadingKeys_[i]=!0,r=Tt.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=n==C.ERROR?Tt.TILELOADERROR:n==C.LOADED?Tt.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new dr(r,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=mr(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(fr(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const n=ht(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}class pr extends ti{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:yr,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:nn,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection){const r=this.tileCacheForProjection[n];r.expireCache(r==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!Le(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!Le(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Le(t,e)))return this.tileGrid;const i=X(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=an(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||Le(t,e))return this.tileCache;const i=X(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new rn(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,n,r,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,r),c=l?this.tileUrlFunction(l,n,r):void 0,h=new this.tileClass(a,c!==void 0?C.IDLE:C.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=o,h.addEventListener(x.CHANGE,this.handleTileChange.bind(this)),h}getTile(e,t,i,n,r){const o=this.getProjection();if(!o||!r||Le(o,r))return this.getTileInternal(e,t,i,n,o||r);const a=this.getTileCacheForProjection(r),l=[e,t,i];let c;const h=sn(l);a.containsKey(h)&&(c=a.get(h));const u=this.getKey();if(c&&c.key==u)return c;const d=this.getTileGridForProjection(o),g=this.getTileGridForProjection(r),f=this.getTileCoordForTileUrlFunction(l,r),_=new St(o,d,r,g,l,f,this.getTilePixelRatio(n),this.getGutter(),(T,E,p,y)=>this.getTileInternal(T,E,p,y,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return _.key=u,c?(_.interimTile=c,_.refreshInterimChain(),a.replace(h,_)):a.set(h,_),_}getTileInternal(e,t,i,n,r){let o=null;const a=ht(e,t,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,i,n,r,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const c=o;o=this.createTile_(e,t,i,n,r,l),c.getState()==C.IDLE?o.interimTile=c.interimTile:o.interimTile=c,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=at(e);if(i){const n=X(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function yr(s,e){s.getImage().src=e}class Er extends pr{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:hr({extent:ei(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const Tr='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Xr extends Er{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[Tr];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",n=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:n,wrapX:e.wrapX,zDirection:e.zDirection})}}export{Gn as A,vr as B,le as C,Ir as D,wr as E,Or as F,br as G,Mr as H,vi as I,Rr as J,Dr as K,Yt as L,kr as M,Nr as N,Xr as O,Ye as P,zr as Q,Fr as R,Ys as S,pr as T,Y as U,oe as V,qt as W,Er as X,jr as Y,or as Z,W as _,on as a,Kr as b,Pi as c,_r as d,mr as e,Gr as f,ws as g,sr as h,Ls as i,M as j,ge as k,Zr as l,Yn as m,Qi as n,Ce as o,ke as p,_i as q,xr as r,js as s,ae as t,Lr as u,Ar as v,Sr as w,Pr as x,Xi as y,Ws as z};
